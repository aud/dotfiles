#!/usr/bin/env ruby

require 'open3'

# 1. Download homebrew
# 2. Running brew bundle (partly for many only - casks)
# 3. Symlink stuff
# 4. Source .bashrc
# 5. Source .system (for mac only)
# 6. Do some stuff to change default shell to bash?

module Utils
  # Common installation utilities

  class << self
    # Check if command exists
    def cmd_exists?(cmd)
      run_cmd("which #{cmd} >/dev/null 2>&1")
    end

    # Shell command out to system and output stdout, stderr
    def run_cmd(cmd)
      stdout, stderr, status = Open3.capture3(cmd)
      puts stdout unless stdout.empty?
      puts stderr unless stderr.empty?

      status.success?
    end
  end
end

# Download homebrew
unless Utils.cmd_exists?("brew")
  Utils.run_cmd('/bin/bash -c "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/HEAD/install.sh)"')
end

# set -euox pipefail

# cd $HOME
# git clone https://github.com/aud/dotfiles
# cd dotfiles

# if ! command -v brew >/dev/null 2>&1; then
#   /bin/bash -c "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/HEAD/install.sh)"
# fi

# if test -f 'Brewfile' && command -v brew bundle check >/dev/null 2>&1; then
#   brew bundle
# fi

# . './symlink.sh'
# . './.bashrc'
